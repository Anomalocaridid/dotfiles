add-highlighter global/ number-lines -hlcursor

# Source plug.kak
source "%val{config}/plugins/plug.kak/rc/plug.kak"

plug "andreyorst/plug.kak" noload

plug "ul/kak-lsp" do %{
    cargo install --locked --force --path .
} config %{
    lsp-enable
    #lsp-auto-hover-enable
    set-option global lsp_diagnostic_line_error_sign '‚úñ'
    set-option global lsp_diagnostic_line_warning_sign '‚û§'
    set-option global lsp_hover_max_lines 10
}

plug "andreyorst/smarttab.kak" defer smarttab %{
    set-option global softtabstop 4
    set-option global smarttab
} config %{
    hook global WinSetOption filetype=(haskell|yaml) expandtab
}

# Highlight current line and/or current column
plug "insipx/kak-crosshairs" config %{
    crosshairs
}

# File tree navigator
plug "andreyorst/kaktree" defer kaktree %{
    set-option global kaktree_double_click_duration '0.5'
    set-option global kaktree_indentation 1
    set-option global kaktree_dir_icon_open  '‚ñæ üóÅ '
    set-option global kaktree_dir_icon_close '‚ñ∏ üóÄ '
    set-option global kaktree_file_icon      '‚†Ä‚†Äüñ∫'
} config %{
    hook global WinSetOption filetype=kaktree %{
        remove-highlighter buffer/numbers
        remove-highlighter buffer/matching
        remove-highlighter buffer/wrap
        remove-highlighter buffer/show-whitespaces
    }
    kaktree-enable
}

# Source my custom powerline theme
source ~/.config/kak/colors/cyberpunk-neon-powerline.kak

# Powerline Bar
# TODO: Investigate creating a theme
plug "andreyorst/powerline.kak" defer powerline %{
    # Use my custom powerline theme
    powerline-theme cyberpunk-neon
    set-option global powerline_shorten_bufname short
    # Default layout
    #set-option global powerline_format 'git bufname line-column mode-info filetype client session position'
} config %{
       powerline-start
}

# Pairing parentheses and brackets
plug "alexherbo2/auto-pairs.kak"

# Highlight recursive pairs of parentheses
# TODO: Configure faces
plug "JJK96/kakoune-rainbow"

# Search highlighter
plug "alexherbo2/search-highlighter.kak"

# fzf integration
plug "andreyorst/fzf.kak"

# Easy navigation of open buffers
plug 'delapouite/kakoune-buffers' %{
    map global normal ^ ': enter-buffers-mode<ret>' -docstring 'buffers'
    map global normal <a-^> ': enter-user-mode -lock buffers<ret>' -docstring 'buffers (lock)'
}

# Preview faces in a colorscheme
plug 'delapouite/kakoune-palette'

# Enhanced selections
plug 'delapouite/kakoune-auto-percent'

# Enhanced searches
plug 'delapouite/kakoune-auto-star'

# Tagbar browsing
plug "andreyorst/tagbar.kak" defer "tagbar" %{
    set-option global tagbar_sort false
    set-option global tagbar_size 40
    set-option global tagbar_display_anon false
} config %{
    # if you have wrap highlighter enamled in you configuration
    # files it's better to turn it off for tagbar, using this hook:
    hook global WinSetOption filetype=tagbar %{
        remove-highlighter window/wrap
        # you can also disable rendering whitespaces here, line numbers, and
        # matching characters
    }
    # Automatically start and hide tagbar on certain filetypes
    hook global WinSetOption filetype=(css|html|haskell|rust) %{
          tagbar-enable
          tagbar-toggle
    }
}

# Manual indentation
plug 'alexherbo2/manual-indent.kak' config %{
    hook global WinCreate .* %{
          manual-indent-enable
    }
}

# Roguelike-style light simulation
plug 'occivink/kakoune-roguelight' config %{
    define-command roguelight-toggle %{
        try %{
            crosshairs
            roguelight-enable
        } catch %{
            roguelight-disable
        }

        hook -group roguelight window RawKey .* roguelight-refresh
    }

    define-command roguelight-map %{
        edit -readonly ~/.config/kak/plugins/kakoune-roguelight/map
        roguelight-toggle
    }
}

# Set colorscheme to custom one
colorscheme cyberpunk-neon

# Buffer user mode
map global user b ':enter-buffers-mode<ret>'              -docstring 'buffers‚Ä¶'
map global user B ':enter-user-mode -lock buffers<ret>'   -docstring 'buffers (lock)‚Ä¶'

# Buffer manipulation aliases
alias global bi info-buffers
alias global bd delete-buffer
alias global bf buffer-first
alias global bl buffer-last
alias global bo buffer-only
alias global bo! buffer-only-force

# Format on save
hook global BufWritePre .* lsp-formatting

# Tabs are 4 characters long
set-option global tabstop 4

# Function Key Mapping
map global normal <F2> ': tagbar-toggle<ret>'
map global normal <F3> ': fzf-mode<ret>'
map global normal <F4> ': kaktree-toggle<ret>'

map global normal <F5> ': info-buffers<ret>'

map global normal <F9> ': lsp-code-actions<ret>'
map global normal <F10> ': lsp-hover<ret>'
map global normal <F11> ': lsp-diagnostics<ret>'
map global normal <F12> ': delete-buffer<ret>'
